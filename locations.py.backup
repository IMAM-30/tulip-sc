# locations.py - FINAL VERSION
# Menggunakan data dari raw_locations.py yang sudah disesuaikan

LOCATION_INDEX = {}

def slugify(name):
    """Convert name to slug format (lowercase, replace spaces with dash)"""
    return name.lower().replace(" ", "-")

def register(group, parent, data):
    """Register location data"""
    for name, (lat, lon) in data.items():
        slug = slugify(name)
        LOCATION_INDEX[slug] = {
            "name": name,
            "group": group,
            "parent": parent,
            "lat": lat,
            "lon": lon,
            "slug": slug
        }

# === LOAD DATA DARI RAW_LOCATIONS ===
try:
    from raw_locations import DEFAULT_LOCATIONS, SULSEL, KECAMATAN
    
    # Register data
    register("default", "Nasional", DEFAULT_LOCATIONS)
    register("sulsel", "Sulawesi Selatan", SULSEL)
    
    for kab, data in KECAMATAN.items():
        register("kecamatan", kab, data)
    
    print(f"âœ… Successfully loaded {len(LOCATION_INDEX)} locations")
    
    # Debug: Show first 5 locations
    print("ðŸ“‹ Sample locations:")
    for i, (slug, loc) in enumerate(list(LOCATION_INDEX.items())[:5]):
        print(f"  {i+1}. {loc['name']} -> {slug}")
    
except ImportError as e:
    print(f"âŒ Error: {e}")
    print("Using minimal fallback data...")
    
    # Fallback minimal data
    FALLBACK_DATA = {
        "Parepare": (-4.0096, 119.6236),
        "Makassar": (-5.1477, 119.4327),
    }
    
    register("sulsel", "Sulawesi Selatan", FALLBACK_DATA)
    print(f"âš ï¸ Using {len(LOCATION_INDEX)} fallback locations")

# === VALIDATION: Cek apakah semua lokasi Laravel ada ===
def validate_laravel_locations():
    """Validate that all Laravel locations exist in our index"""
    laravel_locations = [
        "jakarta-selatan", "luwu-timur", "sinjai", "pangkep", "luwu",
        "duampanua", "pinrang", "makassar", "soreang", "jakarta-timur",
        "barru", "takalar", "balusu", "soppeng", "bacukiki-barat",
        "bacukiki", "watang-sawitto", "parepare", "enrekang", "sidrap",
        "jakarta-utara", "tana-toraja", "bone", "sukabumi", "gowa",
        "cempa", "mallusetasi", "toraja-utara", "batulappa", "bekasi",
        "lanrisang", "cianjur", "luwu-utara", "jeneponto", "palopo",
        "bulukumba", "jakarta-pusat", "bogor", "jakarta-barat", "ujung",
        "maros", "wajo", "tanete-rilau"
    ]
    
    missing = []
    for loc in laravel_locations:
        if loc not in LOCATION_INDEX:
            missing.append(loc)
    
    if missing:
        print(f"âš ï¸ Warning: {len(missing)} Laravel locations not found:")
        for loc in missing[:10]:  # Show first 10 only
            print(f"  - {loc}")
        if len(missing) > 10:
            print(f"  ... and {len(missing)-10} more")
    else:
        print("âœ… All Laravel locations are available!")
    
    return len(missing) == 0

# Run validation
validate_laravel_locations()

print(f"ðŸ“Š Total registered locations: {len(LOCATION_INDEX)}")